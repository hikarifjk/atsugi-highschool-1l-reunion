---
import Layout from '../layouts/Layout.astro';
import participants from '../data/participants.json';
import { getCollection } from 'astro:content';

const formUrl = 'https://example.com/google-form';
const schoolTopImage = 'https://www.pen-kanagawa.ed.jp/atsugi-h/seikatsu/images/img_3365-1.jpg';
const latestNews = (await getCollection('news')).sort(
	(a, b) => b.data.date.getTime() - a.data.date.getTime(),
).slice(0, 5);

const dateFormatter = new Intl.DateTimeFormat('ja-JP', {
	year: 'numeric',
	month: '2-digit',
	day: '2-digit',
});

const getDomain = (value?: string) => {
	if (!value) return '';
	try {
		return new URL(value).hostname;
	} catch {
		return '';
	}
};

const participantCards = participants.map((participant) => {
	const domain = getDomain(participant.youtube) || getDomain(participant.link);
	const fallbackThumbnail = domain
		? `https://www.google.com/s2/favicons?domain=${encodeURIComponent(domain)}&sz=256`
		: '/favicon.svg';

	return {
		...participant,
		thumbnailSrc: participant.thumbnailUrl || fallbackThumbnail,
	};
});
---

<Layout title="厚木高校1L+α 同窓会 | トップ">
	<section class="hero card">
		<img class="school-photo" src={schoolTopImage} alt="神奈川県立厚木高等学校" loading="lazy" />
		<h1>厚木高校1L+α 同窓会のご案内</h1>
		<p>
			2026年5月中旬以降の開催を目指し、<br />
			神奈川県立厚木高等学校 38期生 1年L組+α 同窓会の準備を進めています。
		</p>
		<p>
			本同窓会は、38期生1年L組を中心とした同窓会として企画していますが、澤部先生が担任された2L・3Lの皆さまや、何らかのご縁のある方のご参加も歓迎いたします。
		</p>
		<p>発起人代表 藤岡 光（1年L組）</p>
		<p class="cta-note"><strong>人数把握したいため、仮出欠登録にご協力ください。</strong></p>
		<a class="form-button" href={formUrl} target="_blank" rel="noopener noreferrer">仮出欠登録(Googleフォーム)</a>
	</section>

	<section class="section-block">
		<h2>最新情報</h2>
		<ul class="news-list">
			{
				latestNews.map((item) => (
					<li class="card">
						<p class="news-meta">{dateFormatter.format(item.data.date)}</p>
						<h3>{item.data.title}</h3>
						<p>{item.body}</p>
						{item.data.link && (
							<p><a class="text-link" href={item.data.link} target="_blank" rel="noopener noreferrer">関連リンクを見る</a></p>
						)}
					</li>
				))
			}
		</ul>
	</section>

	<section class="section-block">
		<h2>皆さまの活動紹介</h2>
		<p>皆さまの活動を紹介しています。掲載希望の方は、お店や事業のホームページ、出版した書籍、近況報告等、ぜひお知らせください。</p>
		<div class="participants-grid">
			{
				participantCards.map((participant) => (
					<article class="card participant-card">
						<img src={participant.thumbnailSrc} alt={`${participant.name} サムネイル`} loading="lazy" />
						<h3>{participant.name}</h3>
						<p>{participant.intro}</p>
						{participant.youtube && (
							<p><a class="text-link" href={participant.youtube} target="_blank" rel="noopener noreferrer">YouTubeチャンネル</a></p>
						)}
						{participant.link && (
							<p><a class="text-link" href={participant.link} target="_blank" rel="noopener noreferrer">関連リンク</a></p>
						)}
						<div class="tag-list">
							{participant.categories.map((category) => (
								<span class="tag">{category}</span>
							))}
						</div>
					</article>
				))
			}
		</div>
	</section>
</Layout>

<style>
	h1 {
		font-size: clamp(1.6rem, 3vw, 2.1rem);
		margin: 0 0 1rem;
		color: #8e3f23;
	}

	h2 {
		margin: 0 0 1rem;
		color: #8e3f23;
	}

	h3 {
		margin: 0.2rem 0 0.7rem;
		font-size: 1.1rem;
	}

	p {
		margin: 0 0 0.8rem;
		line-height: 1.7;
	}

	.section-block {
		margin-top: 2rem;
	}

	.card {
		background: var(--card-bg);
		border: 1px solid var(--border);
		border-radius: 14px;
		padding: 1rem;
		box-shadow: 0 10px 24px rgba(133, 89, 56, 0.08);
	}

	.hero {
		background: linear-gradient(180deg, #fffaf3 0%, #fff4e8 100%);
	}

	.school-photo {
		width: 100%;
		border-radius: 12px;
		margin-bottom: 1rem;
		border: 1px solid #ead6c3;
	}

	.cta-note {
		margin-bottom: 0.5rem;
		font-size: 1.02rem;
		color: #8b2f1e;
	}

	.form-button {
		display: inline-block;
		background: linear-gradient(135deg, var(--accent) 0%, var(--accent-strong) 100%);
		color: #fff;
		text-decoration: none;
		font-weight: 700;
		padding: 0.95rem 1.6rem;
		border-radius: 12px;
		margin-top: 0.2rem;
		box-shadow: 0 6px 16px rgba(200, 88, 47, 0.35);
	}

	.form-button:hover {
		filter: brightness(1.05);
	}

	.news-list {
		list-style: none;
		padding: 0;
		margin: 0;
		display: grid;
		gap: 0.8rem;
	}

	.news-meta {
		font-size: 0.9rem;
		color: var(--subtle);
		margin-bottom: 0.3rem;
	}

	.participants-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
		gap: 1rem;
	}

	.participant-card img {
		width: 100%;
		height: auto;
		max-width: 160px;
		display: block;
		margin-bottom: 0.8rem;
		border-radius: 10px;
		border: 1px solid #ead6c3;
		background: #fff;
	}

	.tag-list {
		display: flex;
		flex-wrap: wrap;
		gap: 0.4rem;
	}

	.tag {
		font-size: 0.8rem;
		background: #fde8d6;
		padding: 0.25rem 0.65rem;
		border-radius: 999px;
		color: #8e3f23;
	}

	.text-link {
		color: #b94f2d;
		font-weight: 600;
	}
</style>

